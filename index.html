<!DOCTYPE html>
<html>
<head>
    <title>Chandelier Price Scanner</title>
    <script src="https://cdn.jsdelivr.net/npm/quagga/dist/quagga.min.js"></script>
</head>
<body>
    <h1>Chandelier Price Scanner</h1>
    <div id="scanner"></div>
    <p>Scan a barcode to see the product details.</p>
    <div id="result">
        <p><strong>Product Name:</strong> <span id="product-name"></span></p>
        <p><strong>Price:</strong> <span id="product-price"></span></p>
    </div>

    <script>
        // Initialize the barcode scanner
        Quagga.init({
            inputStream: {
                name: "Live",
                type: "LiveStream",
                target: document.querySelector('#scanner'),
                constraints: {
                    width: 640,
                    height: 480,
                    facingMode: "environment" // Use the rear camera
                },
            },
            decoder: {
                readers: ["ean_reader"] // Barcode format
            }
        }, function (err) {
            if (err) {
                console.error(err);
                return;
            }
            Quagga.start();
        });

        // Handle barcode detection
        Quagga.onDetected(function (result) {
            const barcode = result.codeResult.code;
            fetchProductDetails(barcode);
        });

        // Fetch product details from Google Sheets
        async function fetchProductDetails(barcode) {
            const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSYkC0NJ_meKLT8Y-oG2X48bQaUpZMjLDUz6TBcepnSaL-mvpu_NlAMJaUyA7e5TtHGeuQvs1fIl8UG/pub?output=csv";
            const response = await fetch(sheetUrl);
            const csvData = await response.text();
            const rows = csvData.split('\n');

            for (let row of rows) {
                const [sheetBarcode, productName, quantity, price] = row.split(',');
                if (sheetBarcode.trim() === barcode) {
                    document.getElementById('product-name').textContent = productName;
                    document.getElementById('product-price').textContent = price;
                    return;
                }
            }
            alert("Product not found!");
        }
    </script>
</body>
</html>